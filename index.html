<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNITIL Natural Gas Pipeline Bridge Crossing Assessment Tool</title>
    <link rel="stylesheet" href="index.css">
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.7.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p id="loading-text">Generating Report...</p>
    </div>
    <div id="app-container">
        <header>
            <h1>UNITIL Natural Gas Pipeline Bridge Crossing Assessment Tool</h1>
        </header>

        <div id="controls-top-row" class="controls-row">
            <button id="save-assessment-button" class="control-button">Save Assessment</button>
            <button id="open-assessment-button" class="control-button">Open Assessment</button>
            <button id="generate-report-button" class="control-button">Generate Report</button>
            <button id="generate-paper-form-button" class="control-button">Generate Paper Form</button>
            <button id="example-assessment-button" class="control-button">Example Assessment</button>
            <input type="file" id="open-file-input" style="display: none;" accept=".json">
        </div>
        
        <div id="controls-bottom-row" class="controls-row">
            <div id="admin-unlock-container">
                <div id="admin-locked-view">
                    <label for="admin-password">ADMIN</label>
                    <input type="password" id="admin-password" placeholder="Code">
                    <button type="button" id="admin-unlock-button">Unlock</button>
                </div>
                <div id="admin-unlocked-view" style="display: none;">
                     <label for="api-key-input">API Key:</label>
                     <input type="password" id="api-key-input" placeholder="Enter Google Gemini API Key">
                     <button id="save-api-key-button">Save</button>
                     <span class="api-key-status"></span>
                     <button type="button" id="admin-lock-button" class="control-button secondary">Exit Admin Mode</button>
                </div>
            </div>
        </div>


        <nav id="tab-navigation">
            <button id="tab-form" class="tab-button active" aria-selected="true">Assessment Form</button>
            <button id="tab-process" class="tab-button" aria-selected="false">Process Guidelines</button>
        </nav>
        <main>
            <div id="assessment-form-container" class="tab-content active">
                <form id="assessment-form">
                    <!-- Form content will be dynamically generated by index.tsx -->
                </form>
            </div>
            <div id="process-guidelines-container" class="tab-content" style="display: none;">
                <!-- Process guidelines content will be dynamically generated by index.tsx -->
            </div>
        </main>
    </div>

    <!-- Modal for reviewing generated summaries -->
    <div id="summary-review-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Review & Approve Summaries</h2>
            <p>Please review, edit, and approve the generated summaries before the final report is created.</p>
            
            <div class="modal-field">
                <label for="modal-exec-summary">Executive Summary</label>
                <div id="modal-exec-summary-wrapper" class="input-with-mic-wrapper">
                    <textarea id="modal-exec-summary"></textarea>
                </div>
            </div>

            <div class="modal-field">
                <label for="modal-final-summary">Final Summary of Evaluation</label>
                 <div id="modal-final-summary-wrapper" class="input-with-mic-wrapper">
                    <textarea id="modal-final-summary"></textarea>
                </div>
            </div>

            <div class="modal-actions">
                <button id="modal-cancel-button" class="control-button secondary">Cancel</button>
                <button id="modal-generate-pdf-button" class="control-button">Generate Final PDF</button>
            </div>
        </div>
    </div>

    <!-- AI Interview Modal -->
    <div id="ai-interview-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Clarification Interview</h2>
            <p>The AI will ask a few questions to help clarify details for the report. Your answers will improve the final summary.</p>
            <div id="ai-interview-area">
                <div id="ai-question-area">
                    <div class="spinner-container">
                        <div class="spinner"></div>
                        <p>Analyzing report data...</p>
                    </div>
                </div>
                <div id="user-answer-area">
                    <textarea id="user-answer-input" placeholder="Your answer..." rows="3"></textarea>
                    <button id="submit-answer-button" class="control-button">Submit Answer</button>
                </div>
            </div>
            <div class="modal-actions">
                <button id="skip-interview-button" class="control-button secondary">Skip &amp; Generate Summaries</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script type="module" src="index.tsx"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>